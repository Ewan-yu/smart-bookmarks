# 智能收藏夹管理插件 - 需求设计说明书

## 1. 项目概述

### 1.1 项目名称
Smart Bookmarks - 智能收藏夹管理插件

### 1.2 项目背景
用户在使用浏览器收藏功能时普遍面临以下痛点：
- 历史收藏链接过多、不易归类整理
- 失效链接不易发现和清理
- 缺乏备份机制，换机容易丢失数据

### 1.3 项目目标
开发一款浏览器插件，提供智能分类、失效检测、备份恢复等功能，帮助用户高效管理收藏夹。

### 1.4 目标浏览器
- Chrome (及 Chromium 内核浏览器如 Edge、Brave)
- Firefox (后续支持)

---

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 数据同步与管理

| 功能 | 描述 |
|------|------|
| 浏览器收藏导入 | 首次使用时，自动导入浏览器现有收藏夹数据 |
| 本地副本维护 | 插件内部维护收藏数据副本，所有操作在本地完成 |
| 确认后同步 | 用户确认操作后，同步更新到浏览器收藏夹 |

#### 2.1.2 AI 智能分类

| 功能 | 描述 |
|------|------|
| 用户自配置 API | 用户自行配置 OpenAI 兼容的 API 地址和模型 |
| 一键分析 | 手动触发 AI 分析所有收藏链接 |
| 现有分类采集 | 优先分析用户已有的文件夹结构，作为分类参考 |
| 智能分类建议 | AI 基于标题、URL、网页描述（如有）提供分类建议 |
| 多标签支持 | 一个链接可归属于多个分类/标签 |
| 汇总确认界面 | 显示分类汇总，用户可查看明细并确认后一键应用 |

#### 2.1.3 失效链接检测

| 功能 | 描述 |
|------|------|
| 一键扫描 | 用户手动触发全量收藏链接检测 |
| 失效判断标准 | 访问时打不开的链接视为失效（超时、404、DNS失败等） |
| 待清理文件夹 | 失效链接移动至"待清理"文件夹，不直接删除 |
| 一键删除 | 用户确认后可一键删除待清理文件夹中的链接 |

#### 2.1.4 智能搜索

| 功能 | 描述 |
|------|------|
| 关键词搜索 | 用户输入关键词搜索收藏链接 |
| AI 语义搜索（高级） | 配置 AI 后，支持语义理解搜索 |
| 标签匹配（降级） | 未配置 AI 时，使用标签和标题模糊匹配 |
| 搜索结果高亮 | 高亮显示匹配的关键词和标签 |

#### 2.1.5 备份与恢复

| 功能 | 描述 |
|------|------|
| 本地导出 | 导出为 JSON/HTML 格式文件 |
| 本地导入 | 从备份文件导入数据 |
| 浏览器同步 | 支持浏览器账号自带的收藏同步功能 |

---

## 3. 技术方案

### 3.1 技术栈

| 技术 | 用途 |
|------|------|
| Manifest V3 | Chrome 扩展标准 |
| Vanilla JavaScript | 核心逻辑（不使用框架以减小体积） |
| IndexedDB | 本地数据存储 |
| Chrome Bookmarks API | 浏览器收藏夹操作 |
| Fetch API | HTTP 请求（AI 调用、链接检测） |

### 3.2 数据存储

| 存储方案 | 用途 |
|----------|------|
| IndexedDB | 收藏数据主存储 |
| chrome.storage.local | 用户配置（API 密钥、偏好设置） |

### 3.3 数据结构设计

#### 收藏项 (BookmarkItem)
```typescript
interface BookmarkItem {
  id: string;                    // 唯一标识
  title: string;                 // 标题
  url: string;                   // 链接
  description?: string;          // 网页描述（采集）
  favicon?: string;              // 网站图标
  tags: string[];                // 标签列表
  categories: string[];          // 所属分类
  dateAdded: number;             // 添加时间戳
  dateModified: number;          // 修改时间戳
  status: 'active' | 'broken';   // 状态
  browserId?: string;            // 浏览器收藏ID（用于同步）
}
```

#### 分类 (Category)
```typescript
interface Category {
  id: string;
  name: string;
  parentId?: string;             // 父分类ID（支持层级）
  icon?: string;
}
```

#### 用户配置 (UserConfig)
```typescript
interface UserConfig {
  aiProvider: {
    apiUrl: string;
    apiKey: string;
    model: string;
  };
  preferences: {
    autoSync: boolean;
    theme: 'light' | 'dark' | 'auto';
  };
}
```

### 3.4 网页信息采集方案

采用 **渐进式采集** 策略：

| 场景 | 采集方式 |
|------|----------|
| 新增收藏 | 用户打开页面时，content script 自动采集标题、描述、favicon |
| 历史收藏 | 先用标题+URL 分析，用户可选择"刷新信息"来补充描述 |
| 手动刷新 | 用户右键菜单选择"刷新信息"，打开网页后采集 |

---

## 4. 用户界面设计

### 4.1 界面结构

```
┌─────────────────────────────────────────────────────────┐
│  Smart Bookmarks                          [设置] [关于]  │
├─────────────────────────────────────────────────────────┤
│  🔍 搜索收藏...                                           │
├─────────────────────────────────────────────────────────┤
│  [全部] [工作] [学习] [娱乐] [+ 自定义标签]                │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  📁 工作 (12)                           [一键分析]        │
│    ├─ 📁 前端开发 (5)                                    │
│    │   ├─ React 官方文档                                 │
│    │   ├─ MDN Web 文档                                   │
│    │   └─ ...                                           │
│    └─ 📁 后端开发 (7)                                    │
│                                                           │
│  📁 学习 (8)                                [失效检测]    │
│    └─ ...                                               │
│                                                           │
│  📁 待清理 (3)  ⚠️                                         │
│    └─ ...                                               │
│                                                           │
├─────────────────────────────────────────────────────────┤
│  [导入] [导出] [同步到浏览器]                            │
└─────────────────────────────────────────────────────────┘
```

### 4.2 主要页面

| 页面 | 文件路径 | 描述 |
|------|----------|------|
| Popup | `src/popup/` | 主界面，显示收藏列表 |
| Options | `src/options/` | 设置页面，配置 AI API |
| Background | `src/background/` | 后台脚本，处理数据同步 |

### 4.3 交互流程

#### AI 分析流程
```
用户点击 [一键分析]
    ↓
检查 AI 配置（未配置则提示配置）
    ↓
显示进度弹窗（正在分析 X/Y...）
    ↓
调用 AI API 批量分析
    ↓
显示汇总结果对话框
    ↓
用户点击 [查看明细] 查看具体分类
    ↓
用户点击 [确认并应用]
    ↓
更新本地数据 + 同步到浏览器
```

#### 失效检测流程
```
用户点击 [失效检测]
    ↓
显示进度弹窗（正在检测 X/Y...）
    ↓
并发检测链接（控制并发数）
    ↓
检测完成，汇总结果
    ↓
失效链接移动到"待清理"分类
    ↓
提示用户：发现 X 个失效链接，已移至待清理文件夹
```

---

## 5. 非功能需求

### 5.1 性能要求

| 指标 | 要求 |
|------|------|
| 收藏数量支持 | 10,000+ 条收藏无卡顿 |
| 搜索响应 | < 100ms |
| AI 分析 | 显示进度，不阻塞界面 |
| 失效检测 | 并发控制，避免网络拥堵 |

### 5.2 隐私与安全

| 措施 | 描述 |
|------|------|
| 本地优先 | 数据优先存储在本地，不上传服务器 |
| API 密钥安全 | 用户 API 密钥仅存储在本地 |
| 权限最小化 | 仅请求必要的浏览器权限 |
| 开源透明 | 代码开源，用户可审计 |

### 5.3 兼容性

| 浏览器 | 版本要求 |
|--------|----------|
| Chrome | 88+ |
| Edge | 88+ |
| Firefox | 待支持 |

---

## 6. 开发计划

### 6.1 开发阶段

| 阶段 | 主要任务 |
|------|----------|
| Phase 1 | 基础架构、数据导入导出、UI 框架 |
| Phase 2 | 失效链接检测、标签管理、搜索功能 |
| Phase 3 | AI 智能分类、API 集成 |
| Phase 4 | 优化、测试、发布 |

### 6.2 项目结构

```
smart-bookmarks/
├── manifest.json              # 扩展配置文件
├── package.json               # 项目配置
├── README.md                  # 项目说明
├── docs/                      # 文档
│   └── 需求设计说明书.md
├── icons/                     # 图标资源
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── src/
    ├── background/            # 后台脚本
    │   └── background.js
    ├── content/               # 内容脚本
    │   └── collector.js       # 网页信息采集
    ├── popup/                 # 弹窗页面
    │   ├── popup.html
    │   ├── popup.css
    │   └── popup.js
    ├── options/               # 设置页面
    │   ├── options.html
    │   ├── options.css
    │   └── options.js
    ├── db/                    # 数据库操作
    │   ├── indexeddb.js
    │   └── schema.js
    ├── api/                   # API 调用
    │   └── openai.js
    ├── utils/                 # 工具函数
    │   ├── bookmark-sync.js
    │   ├── link-checker.js
    │   └── helpers.js
    └── assets/                # 静态资源
        └── styles/
```

---

## 7. 后续扩展功能

| 功能 | 优先级 | 描述 |
|------|--------|------|
| 快捷键支持 | 低 | 全局快捷键快速添加收藏 |
| 浏览器历史整合 | 低 | 整合浏览历史，智能推荐收藏 |
| 跨浏览器同步 | 低 | 多浏览器数据同步 |
| 团队分享 | 低 | 收藏夹分享与协作 |
| 统计分析 | 低 | 收藏使用情况统计 |

---

## 8. 风险与限制

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| AI API 成本 | 用户需自行承担 | 提供降级方案（标签匹配） |
| CORS 跨域限制 | 网页信息采集受限 | 采用渐进式采集策略 |
| 收藏数量过大 | 性能问题 | IndexedDB + 虚拟滚动 |
| 浏览器 API 变更 | 兼容性问题 | 关注官方更新，及时适配 |

---

*文档版本: v1.0*
*创建日期: 2026-01-18*
